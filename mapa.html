<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapa Cemitério - Protótipo</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />

  <style>
    #map {
      height: 100vh;
    }
     #map {
    height: 100vh;
    }

    .legend {
    background: white;
    padding: 10px;
    line-height: 1.5;
    color: #333;
    font-size: 14px;
    box-shadow: 0 0 6px rgba(0,0,0,0.3);
    border-radius: 6px;
    }

    .legend i {
    width: 12px;
    height: 12px;
    float: left;
    margin-right: 8px;
    margin-top: 4px;
    opacity: 0.8;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([-7.115, -34.861], 20);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  const bounds = [];

  fetch('http://localhost:3000/mapa/coordenadas')
    .then(response => response.json())
    .then(data => {
      data.forEach(ponto => {

        const cor = ponto.ocupado ? 'red' : 'green';

        const marker = L.circleMarker(
          [ponto.latitude, ponto.longitude],
          {
            radius: 6,
            color: cor,
            fillColor: cor,
            fillOpacity: 0.8
          }
        ).addTo(map);

        marker.bindPopup(`
          <b>Gaveta:</b> ${ponto.id}<br>
          <b>Status:</b> ${ponto.ocupado ? 'Ocupado' : 'Livre'}<br>
          <b>Titular:</b> ${ponto.titular || 'Sem titular'}
        `);

        bounds.push([ponto.latitude, ponto.longitude]);
      });

      if (bounds.length > 0) {
        map.fitBounds(bounds);
      }
    });
</script>

</body>
</html>